{% extends 'arbol_item.html' %}
{% load staticfiles %}


{% block content %}
<div class="clearfix"></div>

<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>Lista de Acciones</h2>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <label for="heard">Filtrar:</label>
                <div class="row">
                    <form method="get" id="frm">
                        <div class="col-md-3 col-sm-12 col-xs-12 form-group">
                            <select name="filtro" id="id_filtro" class="form-control">
                                <option value="SELECCIONE">Seleccione..</option>
                                <option value="TODOS">TODOS</option>
                                <option value="APELLIDO">Apellido</option>
                                <option value="NOMBRE">Nombre</option>
                                <option value="NUMERO_DOCUMENTO">Nro Documento</option>
                                <option value="PROFESION">Profesión</option>
                                <option value="FECHA_INGRESO">Fecha de Ingreso</option>
                                <option value="FECHA_EGRESO">Fecha de Egreso</option>
                                <option value="FECHA_NACIMIENTO">Fecha de Nacimiento</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3 col-sm-12 col-xs-12" id="div_parametro1">
                            <input type="text" id="id_parametro1" name="parametro1" class="form-control col-md-3 col-sm-12 col-xs-12" placeholder="">
                        </div>
                        <div class="form-group col-md-3 col-sm-12 col-xs-12" id="div_parametro2" style="display: none">
                            <input type="text" id="id_parametro2" name="parametro2" class="form-control col-md-3 col-sm-12 col-xs-12">
                        </div>
                        <div class="form-group col-md-3 col-sm-12 col-xs-12">
                            <input class="btn btn-success col-md-3 col-sm-12 col-xs-12" type="button" id="btnBuscar" value="Buscar">
                        </div>
                    </form>
                    <div class="clearfix"></div>
                    {% if messages %}
                        <ul class="messages">
                            {% for message in messages %}
                                <li>{{ message }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
                <div class="row">
                    <div class="x_title"></div>

                    <div style="text-align: right">
                        <button class="btn btn-primary" onclick="window.location='/empleados/alta/'">Nuevo Empleado</button>
                    </div><br>
                    <table id="example" class="table table-striped responsive-utilities jambo_table">
                        <thead>
                            <tr class="headings">
                                <th>Foto </th>
                                <th>Legajo</th>
                                <th>Empleado </th>
                                <th>Profesion</th>
                                <th>Ingreso </th>
                                <th>Egreso </th>
                                <th>Estado</th>
                                <th class=" no-link last">
                                    <span class="nobr">Acción</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in auditoria_list %}
                            <tr class="odd pointer">
                                <td class=" ">{{ empleado.legajo }}</td>
                               
                                <td class=" last">
                                    <a href="/empleados/modi/{{empleado.persona.id}}">
                                        Editar
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                                <div class="alert alert-danger" role="alert">
                                  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                                  <span class="sr-only">Error:</span>
                                    No se encontraron registros
                                </div>
                            {% endfor %}
                        </tbody>
                    </table>

                    {% if is_paginated %}

                    <center>
                    <!--label>Ir a la página: <input type="text" id="page" name="page" size=3></label-->
                    </center>
                    <center>
                       <ul class="pagination">
                           <li id="n_pag_inicio" ><a href="/empleados/listado" title="Ir al inicio"> << </a></li>

                            {% if page_obj.has_previous %}
                                <li id="n_pag_{{page_obj.number}}">
                                  <a href="?page={{ page_obj.previous_page_number }}" id="volver" title="Volver uno"> < </a>
                                </li>
                            {% endif %}

                            <li><a>Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</a></li>

                            {% if page_obj.has_next %}
                                <li id="n_pag_{{page_obj.number}}">
                                  <a href="?page={{ page_obj.next_page_number }}" id="avanzar" title="Avanzar uno"> > </a>
                                </li>
                            {% endif %}

                            <li id="n_pag_fin"><a href="?page=last" title="Ir al final"> >> </a></li>
                        </ul>
                    </center>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<script>

var hoy = new Date();
var dia = hoy.getDate();
var mes = hoy.getMonth() + 1;
var anio = hoy.getFullYear();

var fecha_hactual = (dia<10 ? '0' : '') + dia + '/' + (mes<10 ? '0' : '') + mes + '/' + anio;

$(document).ready(function(){

    $("#div_parametro2").css("display", "none");
    $("#id_parametro1").attr("placeholder", "Seleccione un filtro");

});

$("#id_filtro").change(function(){

    $("#id_parametro1").attr('maxlength', 10);
    $("#id_parametro2").attr('maxlength', 10);

    if($("#id_filtro").val() == "SELECCIONE" || $("#id_filtro").val() == "TODOS"){

        $("#div_parametro1").css("display", "block");
        $("#id_parametro1").css("display", "block");
        $("#id_parametro1").attr("placeholder", "Seleccione un filtro");
        $("#id_parametro1").val("");

        $("#div_parametro2").css("display", "none");
        $("#id_parametro2").val("");

        return;

    }

    if($("#id_filtro").val() != "FECHA_INGRESO" &&
            $("#id_filtro").val() != "FECHA_EGRESO" &&
            $("#id_filtro").val() != "FECHA_NACIMIENTO"){

        $("#div_parametro1").css("display", "block");
        $("#id_parametro1").css("display", "block");
        $("#id_parametro1").val("");
        $("#id_parametro1").attr("placeholder", "Ingrese " + $("#id_filtro").val().toLowerCase());

        $("#div_parametro2").css("display", "none");
        $("#id_parametro2").css("display", "none");
        $("#id_parametro2").val("");

        return;
    }

    if($("#id_filtro").val() == "FECHA_NACIMIENTO"){

        $("#div_parametro1").css("display", "block");
        $("#id_parametro1").css("display", "block");
        $("#id_parametro1").val("");

        $("#div_parametro2").css("display", "none");
        $("#id_parametro2").css("display", "none");
        $("#id_parametro2").val("");

        $("#id_parametro1").attr('placeholder', 'dd/mm/aaaa');

        return;
    }

    if($("#id_filtro").val() == "FECHA_INGRESO" ||
            $('#id_filtro').val() == "FECHA_EGRESO"){

        $("#div_parametro1").css("display", "block");
        $("#id_parametro1").css("display", "block");
        $("#id_parametro1").val("");


        $("#div_parametro2").css("display", "block");
        $("#id_parametro2").css("display", "block");
        $("#id_parametro2").val("");

        $("#id_parametro1").attr('placeholder', 'Fecha Desde: dd/mm/aaaa');
        $("#id_parametro2").attr('placeholder', 'Fecha Hasta: dd/mm/aaaa');

        $("#id_parametro1").val(fecha_hactual);

        return;

    }

});

$("#btnBuscar").click(function(){

    if($("#id_filtro").val() == "SELECCIONE"){
        alert("Por favor seleccione una filtro para la búsqueda!");
        return;
    }

    if($("#id_filtro").val() != "TODOS" && $("#id_parametro1").val() == "") {
        alert("Por favor instroduzca un parametro para la búsqueda!");
        $("#id_parametro1").focus();
        return;
    }

    $("#frm").submit();
});
//   /* ----- Mantener Filtro dentro del paginador y del buscador ---*/
   //formato = window.url.toString().split('?');
   //var a = document.getElementById('avanzar');
   //var v = document.getElementById('volver');
   //f = formato[1].split('&');
   //selector = f[0].split('=');
   //$('#id_filtro').val(selector[1]);
   //console.log(selector[1]);
   //if (f.length == 3){
   //    console.log(f[1]);
   //    formato[1] = f[1] + '&' + f[2];
   //    console.log(formato[1]);
  // }
//   /* ----- Mantener Filtro dentro del paginador y del buscador ---*/

//   alert(f);
  // if (f.length > 1){
  //     if (formato[1] != undefined) {
           {% if page_obj.has_next %}
 //              a.href = "?page={{ page_obj.next_page_number }}&" + formato[1];
          {% endif %}
           {% if page_obj.has_previous %}
  //             v.href = "?page={{ page_obj.previous_page_number }}&" + formato[1];
           {% endif %}
    //   }
 //  }

</script>
{% endblock %}



